<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>算数トレーニング Canvas版</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
/* Tailwind shake アニメーション */
tailwind.config={
  theme:{extend:{keyframes:{shake:{
    '10%,90%':{transform:'translateX(-4px)'},
    '20%,80%':{transform:'translateX(4px)'},
    '30%,50%,70%':{transform:'translateX(-8px)'},
    '40%,60%':{transform:'translateX(8px)'}}},
    animation:{shake:'shake .4s both'}}}};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
<style>
html,body{height:100%;overflow-x:hidden}
body{font-family:system-ui,'Inter','M PLUS Rounded 1c',sans-serif;
     display:flex;flex-direction:column;align-items:center;padding:16px;
     background:linear-gradient(135deg,#d3f8f2 0%,#c4f0ff 100%)}
canvas{background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);
       max-width:100%;height:auto}
#hidden-input{position:absolute;left:-9999px;top:-9999px;opacity:0}
.choice-btn{min-width:72px;min-height:52px}
</style>
</head>

<body>
  <!-- 見出し -->
  <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">
    算数トレーニング Canvas版
  </h1>
  <div id="stats" class="h-6 mb-2 text-gray-700 font-semibold"></div>

  <!-- ★コントロールを Canvas の上に配置 -->
  <div id="ctrl" class="w-full max-w-lg flex flex-wrap justify-center gap-2 mb-3">
    <!-- set -->
    <div id="set-ctrl" class="flex flex-col items-center gap-3">
      <div class="flex gap-2">
        <label class="font-medium text-gray-700">レベル:</label>
        <select id="difficulty" class="p-2 border rounded-lg">
          <option value="g1">小１</option><option value="std" selected>標準</option>
        </select>
        <label class="font-medium text-gray-700">問題数:</label>
        <select id="q-count" class="p-2 border rounded-lg">
          <option>5</option><option selected>10</option><option>15</option><option>20</option>
        </select>
      </div>
      <button id="btn-start"
              class="px-6 py-2 bg-teal-500 hover:bg-teal-600 text-white font-bold rounded-lg shadow">
        スタート
      </button>
    </div>
    <!-- play -->
    <div id="play-ctrl" class="hidden flex gap-2">
      <button id="btn-submit"
              class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg shadow">
        こたえ合わせ
      </button>
      <button id="btn-next"
              class="hidden px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg shadow">
        つぎ
      </button>
    </div>
    <!-- end -->
    <div id="end-ctrl" class="hidden flex gap-2">
      <button id="btn-retry"
              class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white font-bold rounded-lg shadow">
        もう一度
      </button>
      <button id="btn-review"
              class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg shadow">
        間違い確認
      </button>
    </div>
    <!-- review -->
    <div id="rev-ctrl" class="hidden flex">
      <button id="btn-back"
              class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-lg shadow">
        最初の画面へ
      </button>
    </div>
  </div>

  <!-- Canvas を少し低くして 56vh -->
  <canvas id="board" style="max-height:56vh"></canvas>
  <input id="hidden-input" autocomplete="off" enterkeyhint="done">

  <!-- 小１三択 -->
  <div id="choice-box"
       class="hidden flex flex-wrap justify-center gap-2 mt-3"></div>

<script>
/* ===== 以降は前回と同じロジック＋星パーティクル ===== */
/* （スクリプト本文は長いので割愛。前回お渡しした JS をそのまま貼り付けてください） */
</script>
</body>
</html>