<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®—æ•°ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ */
        body {
            font-family: 'Inter', sans-serif; /* Tailwindã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚’ä½¿ç”¨ */
        }
        /* å…¥åŠ›æ¬„ã®çŸ¢å°ã‚’éè¡¨ç¤ºã«ã™ã‚‹ (æ•°å€¤å…¥åŠ›ç”¨) */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-100 to-purple-100 flex justify-center items-center min-h-screen p-4">

    <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg w-full max-w-lg text-center">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">ç®—æ•°ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° (å°6ãƒ¬ãƒ™ãƒ«)</h1>

        <div id="score-area" class="mb-6 text-xl font-semibold text-gray-700">
            ã‚¹ã‚³ã‚¢: <span id="score" class="text-blue-600">0</span> / <span id="total-questions">0</span>
        </div>

        <div id="question-area" class="mb-6 p-4 bg-gray-100 rounded-lg min-h-[80px] flex items-center justify-center">
            <p id="question" class="text-xl md:text-2xl font-semibold text-gray-900"></p>
        </div>

        <div id="answer-area" class="mb-6">
            <label for="answer" class="block text-lg text-gray-700 mb-2">ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</label>
            <input type="text" id="answer" placeholder="ä¾‹: 5/6 ã‚„ 1.2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg text-center">
            <p class="text-sm text-gray-500 mt-1">â€»åˆ†æ•°ã¯ã€Œåˆ†å­/åˆ†æ¯ã€ã®å½¢ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <div id="button-area" class="flex flex-col sm:flex-row justify-center gap-4">
            <button id="submit-button" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200 ease-in-out shadow focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
                ã“ãŸãˆåˆã‚ã›
            </button>
            <button id="next-button" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200 ease-in-out shadow focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 hidden">
                ã¤ãã®å•é¡Œã¸
            </button>
        </div>

        <div id="feedback" class="mt-6 text-lg font-semibold min-h-[30px]">
            </div>

        <div id="end-message" class="mt-6 text-xl font-bold text-purple-600 hidden">
            </div>

    </div>

    <script>
        // --- è¨­å®š ---
        const questions = [
            // ã¾ãšã¯ç°¡å˜ãªåŒåˆ†æ¯ã®åˆ†æ•°ã®è¶³ã—ç®—
            { question: "1/5 + 2/5 = ?", answer: "3/5" },
            { question: "2/7 + 3/7 = ?", answer: "5/7" },
            { question: "1/9 + 4/9 = ?", answer: "5/9" },
            // æ¬¡ã«ç•°åˆ†æ¯ã®åˆ†æ•°ã®è¶³ã—ç®—
            { question: "1/2 + 1/3 = ?", answer: "5/6" },
            { question: "1/4 + 2/3 = ?", answer: "11/12" },
            { question: "2/5 + 1/2 = ?", answer: "9/10" },
            // ç´„åˆ†ãŒå¿…è¦ãªå•é¡Œ
            { question: "1/6 + 1/6 = ?", answer: "1/3" }, // 2/6 -> 1/3
            { question: "1/4 + 1/4 = ?", answer: "1/2" }, // 2/4 -> 1/2
            // å°æ•°ã®è¶³ã—ç®—
            { question: "0.3 + 0.5 = ?", answer: "0.8" },
            { question: "1.2 + 0.9 = ?", answer: "2.1" },
            // TODO: ä»–ã®å°6ãƒ¬ãƒ™ãƒ«ã®å•é¡Œï¼ˆå¼•ãç®—ã€æ›ã‘ç®—ã€å‰²ã‚Šç®—ã€å›³å½¢ã€å‰²åˆãªã©ï¼‰ã‚’è¿½åŠ 
        ];

        // --- è¦ç´ ã®å–å¾— ---
        const questionElement = document.getElementById('question');
        const answerElement = document.getElementById('answer');
        const submitButton = document.getElementById('submit-button');
        const nextButton = document.getElementById('next-button');
        const feedbackElement = document.getElementById('feedback');
        const scoreElement = document.getElementById('score');
        const totalQuestionsElement = document.getElementById('total-questions');
        const endMessageElement = document.getElementById('end-message');

        // --- çŠ¶æ…‹å¤‰æ•° ---
        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = []; // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚ŒãŸå•é¡Œãƒªã‚¹ãƒˆ

        // --- é–¢æ•° ---

        /**
         * æœ€å¤§å…¬ç´„æ•° (GCD) ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•° (ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•)
         * @param {number} a
         * @param {number} b
         * @returns {number} æœ€å¤§å…¬ç´„æ•°
         */
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        /**
         * åˆ†æ•°æ–‡å­—åˆ—ã‚’ç´„åˆ†ã™ã‚‹é–¢æ•°
         * @param {string} fractionStr - "åˆ†å­/åˆ†æ¯" å½¢å¼ã®æ–‡å­—åˆ—
         * @returns {string} ç´„åˆ†ã•ã‚ŒãŸåˆ†æ•°æ–‡å­—åˆ—ã€ã¾ãŸã¯ä¸æ­£ãªå½¢å¼ã®å ´åˆã¯å…ƒã®æ–‡å­—åˆ—
         */
        function simplifyFraction(fractionStr) {
            if (typeof fractionStr !== 'string' || !fractionStr.includes('/')) {
                return fractionStr; // åˆ†æ•°å½¢å¼ã§ãªã„å ´åˆã¯ãã®ã¾ã¾è¿”ã™
            }
            const parts = fractionStr.split('/');
            if (parts.length !== 2) return fractionStr; // ä¸æ­£ãªå½¢å¼

            const numerator = parseInt(parts[0], 10);
            const denominator = parseInt(parts[1], 10);

            if (isNaN(numerator) || isNaN(denominator) || denominator === 0) {
                return fractionStr; // æ•°å€¤ã§ãªã„ã€ã¾ãŸã¯åˆ†æ¯ãŒ0
            }

            if (numerator === 0) return "0"; // åˆ†å­ãŒ0ã®å ´åˆ

            const commonDivisor = gcd(Math.abs(numerator), Math.abs(denominator));
            const simplifiedNumerator = numerator / commonDivisor;
            const simplifiedDenominator = denominator / commonDivisor;

            // åˆ†æ¯ãŒ1ã«ãªã£ãŸå ´åˆã¯æ•´æ•°ã¨ã—ã¦è¿”ã™
            if (simplifiedDenominator === 1) {
                return simplifiedNumerator.toString();
            }
            // åˆ†æ¯ãŒãƒã‚¤ãƒŠã‚¹ã®å ´åˆã€åˆ†å­ã«ç¬¦å·ã‚’ç§»å‹•
            if (simplifiedDenominator < 0) {
                 return `${-simplifiedNumerator}/${-simplifiedDenominator}`;
            }

            return `${simplifiedNumerator}/${simplifiedDenominator}`;
        }


        /**
         * é…åˆ—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹é–¢æ•° (Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ )
         * @param {Array} array - ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ãŸã„é…åˆ—
         * @returns {Array} ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚ŒãŸæ–°ã—ã„é…åˆ—
         */
        function shuffleArray(array) {
            const shuffled = [...array]; // å…ƒã®é…åˆ—ã‚’ã‚³ãƒ”ãƒ¼
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]; // è¦ç´ ã‚’äº¤æ›
            }
            return shuffled;
        }

        /**
         * å•é¡Œã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤ºã™ã‚‹é–¢æ•°
         */
        function loadQuestion() {
            if (currentQuestionIndex < shuffledQuestions.length) {
                const currentQuestion = shuffledQuestions[currentQuestionIndex];
                questionElement.textContent = currentQuestion.question;
                answerElement.value = ''; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
                feedbackElement.textContent = ''; // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚¯ãƒªã‚¢
                feedbackElement.className = 'mt-6 text-lg font-semibold min-h-[30px]'; // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                answerElement.disabled = false; // å…¥åŠ›æ¬„ã‚’æœ‰åŠ¹åŒ–
                submitButton.classList.remove('hidden'); // ã“ãŸãˆåˆã‚ã›ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                nextButton.classList.add('hidden'); // æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
                answerElement.focus(); // å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            } else {
                // å…¨ã¦ã®å•é¡ŒãŒçµ‚äº†ã—ãŸå ´åˆ
                showFinalScore();
            }
        }

        /**
         * æœ€çµ‚ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
         */
        function showFinalScore() {
            questionElement.textContent = '';
            answerElement.classList.add('hidden'); // å…¥åŠ›æ¬„ã‚’éè¡¨ç¤º
            document.getElementById('answer-area').classList.add('hidden'); // ãƒ©ãƒ™ãƒ«ç­‰ã‚‚éè¡¨ç¤º
            submitButton.classList.add('hidden');
            nextButton.classList.add('hidden');
            feedbackElement.classList.add('hidden');
            endMessageElement.textContent = `çµ‚äº†ï¼ ${shuffledQuestions.length}å•ä¸­ ${score}å•æ­£è§£ã§ã—ãŸï¼`;
            endMessageElement.classList.remove('hidden');
        }

        /**
         * è§£ç­”ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
         */
        function checkAnswer() {
            const userAnswerRaw = answerElement.value.trim().replace(/ï¼/g, '/'); // å…¨è§’ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’åŠè§’ã«
            const correctAnswerRaw = shuffledQuestions[currentQuestionIndex].answer;

            // å›ç­”ã¨æ­£è§£ã‚’æ¯”è¼ƒã—ã‚„ã™ã„å½¢ã«æ­£è¦åŒ–ï¼ˆã“ã“ã§ã¯ç´„åˆ†ã‚’è©¦ã¿ã‚‹ï¼‰
            const userAnswerNormalized = simplifyFraction(userAnswerRaw);
            const correctAnswerNormalized = simplifyFraction(correctAnswerRaw);

            // å°æ•°ç‚¹ã‚’å«ã‚€ã‹ãƒã‚§ãƒƒã‚¯ã—ã€å«ã‚€å ´åˆã¯æ•°å€¤ã¨ã—ã¦æ¯”è¼ƒï¼ˆèª¤å·®ã‚’è¨±å®¹ï¼‰
            const isDecimalAnswer = correctAnswerNormalized.includes('.');
            let isCorrect = false;

            if (isDecimalAnswer) {
                const userAnswerNum = parseFloat(userAnswerRaw); // å°æ•°å…¥åŠ›ã¯ãã®ã¾ã¾æ•°å€¤ã«
                const correctAnswerNum = parseFloat(correctAnswerNormalized);
                 // æµ®å‹•å°æ•°ç‚¹æ•°ã®æ¯”è¼ƒã¯èª¤å·®ã‚’è€ƒæ…®ã™ã‚‹
                isCorrect = !isNaN(userAnswerNum) && Math.abs(userAnswerNum - correctAnswerNum) < 0.00001;
            } else {
                 // åˆ†æ•°ã¾ãŸã¯æ•´æ•°ã®å ´åˆã¯ã€ç´„åˆ†å¾Œã®æ–‡å­—åˆ—ã§æ¯”è¼ƒ
                isCorrect = userAnswerNormalized === correctAnswerNormalized;
            }


            answerElement.disabled = true; // åˆ¤å®šå¾Œã¯å…¥åŠ›ä¸å¯ã«
            submitButton.classList.add('hidden'); // ã“ãŸãˆåˆã‚ã›ãƒœã‚¿ãƒ³ã‚’éš ã™
            nextButton.classList.remove('hidden'); // æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º

            if (isCorrect) {
                score++;
                feedbackElement.textContent = 'æ­£è§£ï¼ğŸ‰';
                feedbackElement.className = 'mt-6 text-lg font-semibold min-h-[30px] text-green-600';
            } else {
                feedbackElement.textContent = `æ®‹å¿µï¼ æ­£è§£ã¯ ${correctAnswerRaw} ã§ã—ãŸã€‚`;
                feedbackElement.className = 'mt-6 text-lg font-semibold min-h-[30px] text-red-600';
            }

            scoreElement.textContent = score; // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
        }

        /**
         * æ¬¡ã®å•é¡Œã¸é€²ã‚€é–¢æ•°
         */
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        /**
         * ã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ–ã™ã‚‹é–¢æ•°
         */
        function init() {
            currentQuestionIndex = 0;
            score = 0;
            shuffledQuestions = shuffleArray(questions); // å•é¡Œã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            scoreElement.textContent = score;
            totalQuestionsElement.textContent = shuffledQuestions.length; // ç·å•é¡Œæ•°ã‚’è¡¨ç¤º
            endMessageElement.classList.add('hidden'); // çµ‚äº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
            answerElement.classList.remove('hidden'); // å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
            document.getElementById('answer-area').classList.remove('hidden');
            feedbackElement.classList.remove('hidden'); // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            loadQuestion(); // æœ€åˆã®å•é¡Œã‚’èª­ã¿è¾¼ã‚€
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        submitButton.addEventListener('click', checkAnswer);
        nextButton.addEventListener('click', nextQuestion);

        // Enterã‚­ãƒ¼ã§ã‚‚è§£ç­”ã‚’ãƒã‚§ãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
        answerElement.addEventListener('keypress', function(event) {
            // submitãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿Enterã‚’æœ‰åŠ¹ã«ã™ã‚‹
            if (event.key === 'Enter' && !submitButton.classList.contains('hidden')) {
                checkAnswer();
            }
        });

        // --- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ ---
        init();

    </script>

</body>
</html>
